<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="manifest.json">
  <title>ë””í”¼ê°¤ í”¼ì¶œ</title>
  <style>
    body {
      margin: 0;
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #ffffff;
      color: #222;
    }
    header {
      background-color: #f1f3f5;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .date-display {
      font-size: 1rem;
      text-align: center;
      margin-top: 0.25rem;
      color: #555;
    }
    main {
      padding: 1rem;
    }
    .button {
      background-color: #4f46e5;
      color: white;
      padding: 0.75rem 1rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      margin: 0.5rem 0;
    }
    .list {
      margin-top: 1.5rem;
    }
    .list-item {
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .record-section {
      display: none;
      margin-top: 1.5rem;
    }
    input, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
    }
    .history-section {
      margin-top: 2rem;
    }
    .history-entry {
      background-color: #f9fafb;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
    }
    .stats-box {
      background-color: #eef2ff;
      border: 1px solid #c7d2fe;
      border-radius: 6px;
      padding: 0.75rem 1rem;
      margin-top: 1rem;
      font-size: 1rem;
    }
    .input-group {
      display: flex;
      margin-top: 1.5rem;
      gap: 0.5rem;
    }
    .input-group input {
      flex: 1;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .todo-item.done {
      text-decoration: line-through;
      color: #aaa;
    }
  </style>
</head>
<body>
  <header>
    ë””í”¼ê°¤ í”¼ì¶œ
    <div class="date-display" id="todayDate"></div>
  </header>
  <main>
    <button class="button" id="timerBtn" onclick="toggleTimer()">ğŸµ ì—°ìŠµ ì‹œì‘ (íƒ€ì´ë¨¸)</button>
    <div id="timerDisplay" style="font-size:1.2rem; text-align:center; margin-top:0.5rem; display:none;">00:00</div>

    <div class="stats-box" id="statsBox"></div>

    <div class="input-group">
      <input type="text" id="newPieceInput" placeholder="ìƒˆ ì—°ìŠµê³¡ ì…ë ¥ (ì˜ˆ: Czerny 30)" />
      <button class="button" onclick="addNewPiece()">ì¶”ê°€</button>
    </div>

    <div class="list" id="todoList"></div>

    <div class="record-section" id="recordSection">
      <h3 id="recordTitle">ê¸°ë¡ ì…ë ¥</h3>
      <label>ì—°ìŠµ ì‹œê°„ (ë¶„)</label>
      <input type="number" id="practiceTime" placeholder="ì˜ˆ: 30">
      <label>ë©”ëª¨</label>
      <textarea id="practiceNote" rows="3" placeholder="ì—°ìŠµ ì¤‘ ëŠë‚€ ì ì„ ì ì–´ë³´ì„¸ìš”"></textarea>
      <label>ë§í¬</label>
      <input type="url" id="practiceLink" placeholder="ìœ íŠœë¸Œ ë§í¬ ë“±">
      <button class="button" onclick="saveRecord()">ì €ì¥</button>
    </div>

    <div class="history-section" id="historySection">
      <h3>ğŸ“œ ì—°ìŠµ íˆìŠ¤í† ë¦¬</h3>
      <div id="historyList"></div>
    </div>
  </main>

  <script>
    let currentPiece = '';
    let timer = null;
    let startTime = null;

    function toggleTimer() {
      const btn = document.getElementById('timerBtn');
      const display = document.getElementById('timerDisplay');
      if (!timer) {
        startTime = new Date();
        display.style.display = 'block';
        timer = setInterval(() => {
          const now = new Date();
          const diff = Math.floor((now - startTime) / 1000);
          const min = String(Math.floor(diff / 60)).padStart(2, '0');
          const sec = String(diff % 60).padStart(2, '0');
          display.textContent = `${min}:${sec}`;
        }, 1000);
        btn.textContent = 'â¹ ì—°ìŠµ ì¢…ë£Œ';
      } else {
        clearInterval(timer);
        const now = new Date();
        const diffMin = Math.round((now - startTime) / 1000 / 60);
        document.getElementById('practiceTime').value = diffMin;
        btn.textContent = 'ğŸµ ì—°ìŠµ ì‹œì‘ (íƒ€ì´ë¨¸)';
        display.style.display = 'none';
        display.textContent = '00:00';
        timer = null;
        startTime = null;
        document.getElementById('recordTitle').innerText = `[${currentPiece}] ì—°ìŠµ ê¸°ë¡ ì…ë ¥`;
        document.getElementById('recordSection').style.display = 'block';
      }
    }

    function addNewPiece() {
      const input = document.getElementById('newPieceInput');
      const name = input.value.trim();
      if (!name) return;
      const todo = JSON.parse(localStorage.getItem('practiceTodos') || '[]');
      todo.push({ name, done: false });
      localStorage.setItem('practiceTodos', JSON.stringify(todo));
      input.value = '';
      renderTodo();
    }

    function markDone(index) {
      const todo = JSON.parse(localStorage.getItem('practiceTodos') || '[]');
      todo[index].done = true;
      localStorage.setItem('practiceTodos', JSON.stringify(todo));
      renderTodo();
    }

    function renderTodo() {
      const list = document.getElementById('todoList');
      const todo = JSON.parse(localStorage.getItem('practiceTodos') || '[]');
      list.innerHTML = '';
      todo.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'list-item' + (item.done ? ' done' : '');
        div.innerHTML = `
          <span class="todo-item${item.done ? ' done' : ''}">${item.name}</span>
          <button class="button" onclick="${item.done ? '' : `markDone(${idx})`}">${item.done ? 'ì™„ë£Œë¨' : 'âœ” ëë‚´ê¸°'}</button>`;
        list.appendChild(div);
      });
    }

    function openRecord(title) {
      currentPiece = title;
      document.getElementById('recordTitle').innerText = `[${title}] ì—°ìŠµ ê¸°ë¡ ì…ë ¥`;
      document.getElementById('recordSection').style.display = 'block';
    }

    function saveRecord() {
      const time = parseInt(document.getElementById('practiceTime').value);
      const note = document.getElementById('practiceNote').value;
      const link = document.getElementById('practiceLink').value;
      const date = new Date().toISOString().split('T')[0];

      const record = {
        piece: currentPiece,
        date,
        time,
        note,
        link
      };

      const logs = JSON.parse(localStorage.getItem('practiceLogs') || '[]');
      logs.push(record);
      localStorage.setItem('practiceLogs', JSON.stringify(logs));

      alert(`ì €ì¥ ì™„ë£Œ!\n\nê³¡: ${currentPiece}\nì‹œê°„: ${time}ë¶„\në‚ ì§œ: ${date}`);

      document.getElementById('practiceTime').value = '';
      document.getElementById('practiceNote').value = '';
      document.getElementById('practiceLink').value = '';
      document.getElementById('recordSection').style.display = 'none';

      renderHistory();
      renderStats();
    }

    function renderHistory() {
      const logs = JSON.parse(localStorage.getItem('practiceLogs') || '[]');
      const container = document.getElementById('historyList');
      container.innerHTML = '';
      logs.slice().reverse().forEach(log => {
        const div = document.createElement('div');
        div.className = 'history-entry';
        div.innerHTML = `<strong>${log.date}</strong> Â· <em>${log.piece}</em><br>â± ${log.time}ë¶„<br>${log.note}<br><a href="${log.link}" target="_blank">${log.link}</a>`;
        container.appendChild(div);
      });
    }

    function renderStats() {
      const logs = JSON.parse(localStorage.getItem('practiceLogs') || '[]');
      let totalTime = 0;
      logs.forEach(log => {
        totalTime += parseInt(log.time || 0);
      });
      const statsBox = document.getElementById('statsBox');
      statsBox.innerText = `â± ì´ ì—°ìŠµ ì‹œê°„: ${totalTime}ë¶„ | ğŸ§¾ ì´ ì—°ìŠµ íšŸìˆ˜: ${logs.length}íšŒ`;
    }

    function showTodayDate() {
      const today = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
      document.getElementById('todayDate').innerText = today.toLocaleDateString('ko-KR', options);
    }

    showTodayDate();
    renderTodo();
    renderHistory();
    renderStats();
  </script>
</body>
</html>
